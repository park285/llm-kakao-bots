package party.qwer.twentyq.ai.strategy

import org.springframework.stereotype.Component
import party.qwer.twentyq.ai.ResponseSchema
import party.qwer.twentyq.config.AppProperties
import party.qwer.twentyq.service.gemini.GeminiGenerationFacade
import party.qwer.twentyq.service.gemini.GenerationRequest

@Component
class HintsGenerationStrategy(
    private val generation: GeminiGenerationFacade,
    private val appProperties: AppProperties,
) : GenerationStrategy {
    override suspend fun generate(
        systemPrompt: String,
        userPrompt: String,
        temperature: Double,
        topP: Double,
        maxTokens: Int?,
        schema: ResponseSchema?,
    ): String {
        val config = appProperties.ai.gemini
        val model = config.model
        val thinkingBudget = config.hintsThinkingBudget

        return generation.generate(
            GenerationRequest(
                operation = "hints",
                model = model,
                systemPrompt = systemPrompt,
                userPrompt = userPrompt,
                temperature = temperature,
                topP = topP,
                thinkingBudget = thinkingBudget,
                maxTokens = maxTokens,
                schema = schema,
            ),
        )
    }
}
