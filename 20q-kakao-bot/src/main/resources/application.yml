server:
  shutdown: graceful

spring:
  main:
    banner-mode: off
  application:
    name: 20q-kakao-bot-service
  lifecycle:
    timeout-per-shutdown-phase: 30s

  cache:
    type: redis
  data:
    redis:
      host: ${CACHE_HOST:localhost}
      port: ${CACHE_PORT:6379}
      timeout: 2000ms
    r2dbc:
      url: r2dbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:twentyq}
      username: ${DB_USER:twentyq_app}
      password: ${DB_PASSWORD:}
      pool:
        initial-size: 5
        max-size: 20
        max-idle-time: 30m
        max-acquire-time: 3s
        max-create-connection-time: 5s

app:
  cache:
    session-ttl-minutes: ${SESSION_TTL_MINUTES:120}
    medium-ttl-minutes: ${SESSION_MEDIUM_TTL_MINUTES:180}
    long-ttl-minutes: ${SESSION_LONG_TTL_MINUTES:360}
    very-long-ttl-minutes: ${SESSION_VERY_LONG_TTL_MINUTES:720}
    vector-embedding-max-size: ${VECTOR_EMBEDDING_MAX_SIZE:100000}
    vector-embedding-ttl-hours: ${VECTOR_EMBEDDING_TTL_HOURS:24}
  
  mq:
    host: ${MQ_HOST:localhost}
    port: ${MQ_PORT:1833}
    password: ${MQ_PASSWORD:}
    timeout: ${MQ_TIMEOUT:5000}
    consumer-group: ${MQ_CONSUMER_GROUP:20q-bot-group}
    consumer-name: ${MQ_CONSUMER_NAME:consumer-1}
    stream-key: ${MQ_STREAM_KEY:kakao:20q}
  
  topics:
    directory: ${TOPICS_DIRECTORY:classpath:topics/}
  
  riddle:
    game:
      bonus-hint-question-threshold: ${BONUS_HINT_QUESTION_THRESHOLD:20}
      default-hint-limit: ${DEFAULT_HINT_LIMIT:2}
      bonus-hint-limit: ${BONUS_HINT_LIMIT:2}
      recent-topics-limit: ${RECENT_TOPICS_LIMIT:20}
    validation:
      enabled: ${RIDDLE_VALIDATION_ENABLED:false}
      max-retries: ${RIDDLE_VALIDATION_MAX_RETRIES:1}
    normalize:
      mode: ${RIDDLE_NORMALIZE_MODE:always}
  
  ai:
    provider: ${AI_PROVIDER:gemini}
    gemini:
      api-key: ${GOOGLE_API_KEY}
      api-keys: ${GOOGLE_API_KEYS:}
      model: ${GEMINI_MODEL:gemini-3-pro-preview}
      answer-model: ${GEMINI_ANSWER_MODEL:gemini-3-pro-preview}
      blind-model: ${GEMINI_BLIND_MODEL:gemini-3-pro-preview}
      embedding-model: ${GEMINI_EMBEDDING_MODEL:gemini-embedding-001}
      create-thinking-budget: ${GEMINI_CREATE_THINKING_BUDGET:2048}
      hints-thinking-budget: ${GEMINI_HINTS_THINKING_BUDGET:8192}
      answer-thinking-budget: ${GEMINI_ANSWER_THINKING_BUDGET:4096}
      blind-thinking-budget: ${GEMINI_BLIND_THINKING_BUDGET:6144}
      active-budget-profile: ${GEMINI_BUDGET_PROFILE:balanced}
      budget-profiles:
        fast:
          name: fast
          create-budget: 1024
          hints-budget: 4096
          answer-budget: 2048
          blind-budget: 3072
        balanced:
          name: balanced
          create-budget: 2048
          hints-budget: 6144
          answer-budget: 3072
          blind-budget: 4608
        quality:
          name: quality
          create-budget: 4096
          hints-budget: 8192
          answer-budget: 4096
          blind-budget: 6144
      cache-enabled: ${GEMINI_CACHE_ENABLED:true}
      ttl-seconds: ${GEMINI_CACHE_TTL_SECONDS:3600}
      http:
        response-timeout-seconds: ${GEMINI_HTTP_RESPONSE_TIMEOUT_SECONDS:30}
        connect-timeout-millis: ${GEMINI_HTTP_CONNECT_TIMEOUT_MILLIS:15000}

  normalize:
    cache:
      enabled: ${NORMALIZE_CACHE_ENABLED:true}
  
  security:
    injection:
      enabled: ${INJECTION_GUARD_ENABLED:true}
      threshold: ${INJECTION_GUARD_THRESHOLD:0.7}
      rulepacks:
        - security/rulepacks/injection-en.yml
        - security/rulepacks/injection-ko.yml
    meta-question-llm-enabled: ${META_QUESTION_LLM_ENABLED:true}
  
  access:
    enabled: ${ACCESS_ENABLED:false}
    allowed-chat-ids: ${ALLOWED_CHAT_IDS:}
    blocked-chat-ids: ${BLOCKED_CHAT_IDS:}
    blocked-user-ids: ${BLOCKED_USER_IDS:}
    passthrough: ${ACCESS_PASSTHROUGH:false}
  
  commands:
    prefix: ${COMMAND_PREFIX:/스자}
  
  admin:
    user-ids: ${ADMIN_USER_IDS:}
  
  pricing:
    model: ${PRICING_MODEL:flash-25}

llm:
  rest:
    base-url: ${LLM_REST_BASE_URL:http://localhost:40527}
    timeout-seconds: ${LLM_REST_TIMEOUT_SECONDS:120}
    connect-timeout-seconds: ${LLM_REST_CONNECT_TIMEOUT_SECONDS:10}
    http2-enabled: ${LLM_REST_HTTP2_ENABLED:true}
    health-enabled: ${LLM_REST_HEALTH_ENABLED:true}
    health-path: ${LLM_REST_HEALTH_PATH:/health}
    health-interval-millis: ${LLM_REST_HEALTH_INTERVAL_MILLIS:60000}
    health-failure-threshold: ${LLM_REST_HEALTH_FAILURE_THRESHOLD:5}
    health-restart-command: ${LLM_REST_HEALTH_RESTART_COMMAND:./bot-restart.sh}
    health-restart-containers: ${LLM_REST_HEALTH_RESTART_CONTAINERS:}
    health-docker-socket: ${LLM_REST_HEALTH_DOCKER_SOCKET:/var/run/docker.sock}

logging:
  level:
    party.qwer.twentyq: ${LOG_LEVEL:INFO}

management:
  endpoints:
    web:
      exposure:
        include: health,info,refresh
  endpoint:
    refresh:
      enabled: true
